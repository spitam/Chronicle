{"ruleId": "ru_d1cbfa07-d4e5-4854-8f1a-ea35d1f47f6a", "versionId": "ru_d1cbfa07-d4e5-4854-8f1a-ea35d1f47f6a@v_1715255861_679919000", "ruleName": "AWS_Objects_Deleted_from_the_Cloudtrail_S3_Bucket", "metadata": {"author": "Deloitte", "description": "Detect when an attacker is trying to evade defenses by deleting an object from Cloudtrail's S3 Bucket which holds all S3 Events.", "mitre_attack_tactic": "Defense Evasion", "mitre_attack_technique": "Impair Defenses: Disable Cloud Logs", "data_source": "AWS CloudTrail", "platform": "AWS", "severity": "High", "name": "AWS_Objects_Deleted_from_the_Cloudtrail_S3_Bucket"}, "ruleText": " rule AWS_Objects_Deleted_from_the_Cloudtrail_S3_Bucket {\n  \n  meta:\n    name=\"AWS_Objects_Deleted_from_the_Cloudtrail_S3_Bucket\"\n    author = \"Deloitte\"\n    description = \"Detect when an attacker is trying to evade defenses by deleting an object from Cloudtrail's S3 Bucket which holds all S3 Events.\"\n    mitre_attack_tactic = \"Defense Evasion\"\n    mitre_attack_technique = \"Impair Defenses: Disable Cloud Logs\"\n    data_source = \"AWS CloudTrail\"\n    platform = \"AWS\"\n    severity = \"High\"\n\n  events:\n    $cloudtrail.metadata.vendor_name = \"AMAZON\"\n    $cloudtrail.metadata.product_name = \"AWS CloudTrail\"\n    $cloudtrail.metadata.product_event_type = \"DeleteDetector\"\n    $cloudtrail.security_result.action = \"ALLOW\"\n    $cloudtrail.principal.user.user_display_name = $user_id\n\n  match:\n    $user_id over 1h\n\n  outcome:\n    $risk_score = max(75)\n    $mitre_attack_tactic = \"Defense Evasion\"\n    $mitre_attack_technique = \"Impair Defenses: Disable Cloud Logs\"\n    $mitre_attack_technique_id = \"T1562.008\"\n    $event_count = count_distinct($cloudtrail.metadata.id)\n    $network_http_user_agent = array_distinct($cloudtrail.network.http.user_agent)\n    $principal_ip = array_distinct($cloudtrail.principal.ip)\n    $principal_ip_country = array_distinct($cloudtrail.principal.ip_geo_artifact.location.country_or_region)\n    $principal_ip_state = array_distinct($cloudtrail.principal.ip_geo_artifact.location.state)\n    $principal_user_display_name = array_distinct($cloudtrail.principal.user.user_display_name)\n    $recipient_aws_account_id = array_distinct($cloudtrail.target.resource.attribute.labels[\"Recipient Account Id\"])\n    $aws_region = array_distinct($cloudtrail.principal.location.name)\n    $target_resource_name = array_distinct($cloudtrail.target.resource.name)\n    $target_resource_product_object_id = array_distinct($cloudtrail.target.resource.product_object_id)\n\n  condition:\n    $cloudtrail\n}\n", "versionCreateTime": "2024-05-09T11:57:41.679919Z", "compilationState": "SUCCEEDED", "ruleType": "SINGLE_EVENT", "lastAlertStatusChangeTime": "2024-04-20T15:58:25.839487Z"}