{"ruleId": "ru_4ba1f1fe-7f75-4451-aeb1-d7406cb8180b", "versionId": "ru_4ba1f1fe-7f75-4451-aeb1-d7406cb8180b@v_1717431086_077711000", "ruleName": "AWS_Organizations_Service_Control_Policy_Deleted", "metadata": {"mitre_attack_tactic": "Impact", "mitre_attack_technique": "Data Destruction", "data_source": "AWS CloudTrail", "platform": "AWS", "severity": "Medium", "name": "AWS_Organizations_Service_Control_Policy_Deleted", "author": "Deloitte", "description": "Identifies attempts to update the policy of an AWS KMS Customer Managed Key (CMK). Deleting an AWS KMS key is destructive and potentially dangerous. It deletes the key material and all metadata associated with the KMS key and is irreversible. After a KMS key is deleted, the data that was encrypted under that KMS key can no longer be decrypted, which means that data becomes unrecoverable."}, "ruleText": " rule AWS_Organizations_Service_Control_Policy_Deleted {\n  \n  meta:\n    name=\"AWS_Organizations_Service_Control_Policy_Deleted\"\n    author = \"Deloitte\"\n    description = \"Identifies attempts to update the policy of an AWS KMS Customer Managed Key (CMK). Deleting an AWS KMS key is destructive and potentially dangerous. It deletes the key material and all metadata associated with the KMS key and is irreversible. After a KMS key is deleted, the data that was encrypted under that KMS key can no longer be decrypted, which means that data becomes unrecoverable.\"\n    mitre_attack_tactic = \"Impact\"\n    mitre_attack_technique = \"Data Destruction\"\n    data_source = \"AWS CloudTrail\"\n    platform = \"AWS\"\n    severity = \"Medium\"\n\n  events:\n    $cloudtrail.metadata.vendor_name = \"AMAZON\"\n    $cloudtrail.metadata.product_name = \"AWS CloudTrail\"\n    $cloudtrail.target.application = \"organizations.amazonaws.com\"\n    $cloudtrail.metadata.product_event_type = \"DeletePolicy\"\n    $cloudtrail.security_result.action = \"ALLOW\"\n    $cloudtrail.principal.user.user_display_name = $user_id\n\n  match:\n    $user_id over 1h\n\n  outcome:\n    $risk_score = max(75)\n    $mitre_attack_tactic = \"Impact\"\n    $mitre_attack_technique = \"Data Destruction\"\n    $mitre_attack_technique_id = \"T1485\"\n    $event_count = count_distinct($cloudtrail.metadata.id)\n    $network_http_user_agent = array_distinct($cloudtrail.network.http.user_agent)\n    $principal_ip = array_distinct($cloudtrail.principal.ip)\n    $principal_ip_country = array_distinct($cloudtrail.principal.ip_geo_artifact.location.country_or_region)\n    $principal_ip_state = array_distinct($cloudtrail.principal.ip_geo_artifact.location.state)\n    $principal_user_display_name = array_distinct($cloudtrail.principal.user.user_display_name)\n    $recipient_aws_account_id = array_distinct($cloudtrail.target.resource.attribute.labels[\"Recipient Account Id\"])\n    $aws_region = array_distinct($cloudtrail.principal.location.name)\n    $target_resource_name = array_distinct($cloudtrail.target.resource.name)\n    $target_resource_product_object_id = array_distinct($cloudtrail.target.resource.product_object_id)\n\n  condition:\n    $cloudtrail\n}\n", "versionCreateTime": "2024-06-03T16:11:26.077711Z", "compilationState": "SUCCEEDED", "ruleType": "SINGLE_EVENT", "lastAlertStatusChangeTime": "2024-06-03T16:06:09.877439Z"}